#!/bin/bash
set -e

cd $(dirname $0)/..

function echoexec() {
  echo $@
  $@
}

cd files

for file in $(git ls-files); do
  target=$HOME/$file

  if [ ! -h $target ]; then
    if [ -f $target ]; then
      echoexec mv $target $target.backup
    fi

    directory=$(dirname $target)

    if [ ! -d $directory ]; then
      echoexec mkdir -p $directory
    fi

    echoexec ln -sfn $(pwd)/$file $target
  fi
done

if ! type brew &>/dev/null; then
  $(command -v ruby) -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

set -v

brew update

brew upgrade

brew install \
  awscli \
  bash-completion \
  circleci \
  git \
  go \
  heroku/brew/heroku \
  imagemagick \
  libmagic \
  ncdu \
  neovim \
  node \
  postgresql \
  python2 \
  python3 \
  rbenv \
  redis \
  shfmt \
  terraform \
  yarn

brew cask install \
  chromedriver \
  docker \
  google-backup-and-sync \
  google-chrome \
  keepassx \
  postman \
  slack \
  spotify \
  tunnelblick \
  visual-studio-code

brew cleanup

brew doctor

brew missing

git config --global core.editor "code --wait"

git config --global core.excludesfile "~/.gitignore"

git config --global fetch.prune true

heroku plugins:install autocomplete

pip install --upgrade pip

pip install --upgrade setuptools

pip3 install --upgrade pip

pip3 install --upgrade setuptools

pip3 install --upgrade virtualenv

echo "setup complete"
